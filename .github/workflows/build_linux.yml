name: Build linux

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:
    inputs:
      branch:
        description: 'Target branch'     
        required: true
        default: 'main'

jobs:
  build_linux:
    
    runs-on: ubuntu-latest

    steps:

    # Install google protobuf
    - name: Setup protoc
      run: sudo apt install libprotobuf-dev protobuf-compiler
      shell: bash

    # Checkout shell framework project
    - name: Checkout shell framework
      uses: actions/checkout@v2
      with:
        repository: dterletskiy/shell_fw
        path: ./shell_fw
        ref: ${{ github.ref }}

    # Checkout project's revision, which is pushed
    - name: Checkout of the project
      uses: actions/checkout@v2
      with:
        repository: dterletskiy/${{ github.event.repository.name }}
        path: ./${{ github.event.repository.name }}
        ref: ${{ github.ref }}

    # CMake execution
    - name: Build
      run: ./build.sh --arch=x86_64 --os=linux --action=clean_build
      shell: bash
      working-directory: ./${{ github.event.repository.name }}



    # # Create build directory
    # - name: Creation of the "../build" directory
    #   run: mkdir ../build
    #   shell: bash
    #   working-directory: ./

    # # CMake execution
    # - name: CMake
    #   run: cmake ../${{ github.event.repository.name }}/dma_framework
    #   shell: bash
    #   working-directory: ../build
    
    # # Build of the project
    # - name: Make
    #   run: make -j8
    #   shell: bash
    #   working-directory: ../build

    # # Unit-tests execution
    # - name: unit-tests
    #   run: make -j8 test
    #   shell: bash
    #   working-directory: ../build
